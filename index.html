<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rahata Store | Real-time Database</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #111111;
            --bg: #ffffff;
            --gray: #f5f5f5;
            --danger: #d32f2f;
            --success: #007d48;
            --admin-color: #2563eb;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background-color: var(--bg); color: var(--primary); overflow-x: hidden; display: flex; flex-direction: column; min-height: 100vh; }

        /* --- Navbar --- */
        header { background: white; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid #eee; }
        .navbar { max-width: 1440px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; padding: 15px 40px; position: relative; }
        
        .logo { display: block; text-decoration: none; }
        .logo img { height: 50px; width: auto; object-fit: contain; display: block; }

        .nav-links { display: flex; list-style: none; gap: 30px; position: absolute; left: 50%; transform: translateX(-50%); margin: 0; }
        .nav-links li { cursor: pointer; font-weight: 600; font-size: 0.9rem; transition: 0.2s; text-transform: uppercase; letter-spacing: 0.5px; position: relative; }
        .nav-links li:hover { opacity: 0.6; }
        .nav-links li.active::after { content: ''; position: absolute; bottom: -24px; left: 0; width: 100%; height: 2px; background: black; }
        #nav-sale { color: var(--danger); }
        #nav-sale.active::after { background: var(--danger); }

        .right-group { display: flex; align-items: center; gap: 20px; }
        .search-wrapper { position: relative; width: 220px; transition: width 0.3s ease; }
        .search-wrapper:focus-within { width: 280px; }
        .search-input { width: 100%; padding: 8px 35px 8px 15px; border-radius: 20px; border: 1px solid #ddd; background: #f9f9f9; font-size: 0.9rem; outline: none; transition: background 0.3s, border-color 0.3s; }
        .search-input:focus { background: white; border-color: #111; }
        .search-icon { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: #999; pointer-events: none; font-size: 0.9rem; }
        .icon-btn { cursor: pointer; font-size: 1.2rem; background: none; border: none; position: relative; transition: transform 0.2s; color: var(--primary); }
        .icon-btn:hover { transform: scale(1.1); }
        
        #admin-btn.active-admin { color: var(--admin-color); }

        .cart-badge { position: absolute; top: -5px; right: -8px; background: var(--primary); color: white; font-size: 0.65rem; padding: 2px 6px; border-radius: 10px; font-weight: bold; }

        /* --- Page Content --- */
        .page-section { display: none; animation: fadeIn 0.5s ease; flex: 1; } 
        .page-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Hero & Grid --- */
        .hero { width: 100%; height: 80vh; position: relative; background-image: url('https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?ixlib=rb-1.2.1&auto=format&fit=crop&w=1920&q=80'); background-size: cover; background-position: center; display: flex; align-items: flex-end; padding-bottom: 60px; margin-bottom: 40px; }
        .hero-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to top, rgba(0,0,0,0.7), transparent); }
        .hero-content { position: relative; z-index: 2; color: white; padding-left: 5%; max-width: 700px; }
        .hero h1 { font-size: 3.5rem; font-weight: 900; line-height: 0.95; margin-bottom: 20px; text-transform: uppercase; }
        .hero-btn { background-color: white; color: black; padding: 12px 35px; border-radius: 30px; text-decoration: none; font-weight: 700; display: inline-block; cursor: pointer; transition: 0.3s; border: none; font-size: 1rem; }
        
        .container { max-width: 1440px; margin: 0 auto; padding: 0 5%; }
        .section-title { font-size: 2rem; font-weight: 800; text-transform: uppercase; margin-bottom: 10px; text-align: center; margin-top: 40px; }
        .section-desc { text-align: center; color: #666; margin-bottom: 40px; font-size: 1rem; }
        .product-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 40px 30px; margin-bottom: 60px; }
        
        .product-card { cursor: pointer; transition: transform 0.3s; position: relative; }
        .product-card:hover { transform: translateY(-5px); }
        .product-image { width: 100%; aspect-ratio: 1/1; background: var(--gray); margin-bottom: 15px; position: relative; overflow: hidden; border-radius: 4px; }
        .product-image img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        .product-card:hover img { transform: scale(1.05); }
        .stock-badge { position: absolute; top: 10px; left: 10px; background: rgba(255,255,255,0.9); padding: 4px 10px; font-size: 0.75rem; font-weight: 700; border-radius: 4px; text-transform: uppercase; z-index: 2; }
        .sale-badge { position: absolute; top: 10px; right: 10px; background: var(--danger); color: white; padding: 4px 10px; font-size: 0.75rem; font-weight: 700; border-radius: 4px; text-transform: uppercase; z-index: 2; }
        
        .product-info { display: flex; flex-direction: column; gap: 4px; }
        .product-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 4px; color: var(--primary); }
        .product-category { color: #757575; font-size: 0.9rem; }
        .product-price-wrap { display: flex; gap: 10px; align-items: center; margin-top: 6px; }
        .product-price { font-weight: 600; font-size: 1rem; }
        .product-old-price { text-decoration: line-through; color: #999; font-size: 0.9rem; }
        .product-discount-price { color: var(--danger); font-weight: 700; font-size: 1rem; }

        /* --- Admin Controls --- */
        .admin-controls { display: none; margin-top: 10px; gap: 5px; flex-wrap: wrap; }
        .admin-active .admin-controls { display: flex; }
        .btn-admin-edit { background: var(--admin-color); color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.75rem; flex: 1; }
        .btn-admin-sale { background: #f59e0b; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.75rem; flex: 1; }
        .btn-admin-delete { background: var(--danger); color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.75rem; flex: 1; }
        .btn-admin-stock { background: var(--success); color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.75rem; flex: 1; }
        
        .admin-panel { display: none; background: #f0f9ff; border: 1px solid #bae6fd; padding: 20px; margin-bottom: 40px; border-radius: 8px; }
        .admin-active .admin-panel { display: block; }
        .admin-form { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .admin-form input, .admin-form select { padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .admin-form-full { grid-column: 1 / -1; }

        /* --- Footer, FAQ & About Features (FIXED) --- */
        .faq-wrap, .about-wrap { max-width: 800px; margin: 60px auto; padding: 0 20px; }
        .faq-item { border-bottom: 1px solid #eee; padding: 20px 0; }
        .faq-question { font-weight: 700; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-size: 1.1rem; }
        .faq-answer { display: none; margin-top: 15px; color: #555; line-height: 1.6; }
        .faq-item.active .faq-answer { display: block; animation: fadeIn 0.3s; }
        .faq-icon { transition: 0.3s; }
        .faq-item.active .faq-icon { transform: rotate(180deg); }

        /* CSS Features */
        .features { display: flex; justify-content: center; gap: 40px; flex-wrap: wrap; text-align: center; margin-top: 30px; }
        .feature-box { flex: 1; min-width: 200px; padding: 20px; background: var(--gray); border-radius: 8px; display: flex; flex-direction: column; align-items: center; }
        .feature-box i { font-size: 2rem; margin-bottom: 15px; color: var(--primary); }
        .feature-box h3 { font-size: 1.1rem; font-weight: 700; margin-bottom: 5px; }

        footer { background-color: #111; color: #fff; padding: 60px 5% 20px; margin-top: auto; }
        .footer-content { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 40px; max-width: 1440px; margin: 0 auto; margin-bottom: 40px; }
        .footer-section h3 { font-size: 1.2rem; font-weight: 700; margin-bottom: 20px; color: #fff; text-transform: uppercase; }
        .footer-section p, .footer-section a { color: #999; font-size: 0.9rem; line-height: 1.8; text-decoration: none; display: block; margin-bottom: 8px; transition: 0.2s; }
        .footer-section a:hover { color: #fff; }
        /* Social Media Icons Color Hover */
        .footer-section a:hover .fa-instagram { color: #E1306C; }
        .footer-section a:hover .fa-tiktok { color: #00f2ea; }
        .footer-section a:hover .fa-facebook { color: #4267B2; }
        
        .footer-bottom { border-top: 1px solid #333; padding-top: 20px; text-align: center; color: #555; font-size: 0.8rem; }

        /* --- Modals --- */
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; backdrop-filter: blur(3px); }
        .modal-content { background: white; width: 95%; max-width: 900px; height: auto; max-height: 90vh; display: flex; overflow: hidden; }
        .modal-left { flex: 1.1; background: var(--gray); display: flex; align-items: center; justify-content: center; }
        .modal-left img { width: 100%; height: 100%; object-fit: cover; }
        .modal-right { flex: 1; padding: 40px; overflow-y: auto; display: flex; flex-direction: column; }
        .close-modal { align-self: flex-end; font-size: 1.5rem; cursor: pointer; margin-bottom: 10px; }

        /* LOGIN MODAL SPECIFIC STYLE */
        .login-modal-content { background: white; padding: 40px; border-radius: 8px; width: 400px; text-align: center; position: relative; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .login-title { font-size: 1.5rem; font-weight: 800; margin-bottom: 10px; text-transform: uppercase; }
        .login-subtitle { color: #777; font-size: 0.9rem; margin-bottom: 30px; }
        .login-field { width: 100%; padding: 12px 15px; margin-bottom: 15px; border: 1px solid #eee; border-radius: 6px; background: #f9f9f9; outline: none; font-size: 0.95rem; transition: 0.3s; }
        .login-field:focus { background: white; border-color: black; }
        .login-error { color: var(--danger); font-size: 0.85rem; margin-bottom: 15px; display: none; }
        .login-btn { width: 100%; background: black; color: white; padding: 12px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 1rem; transition: 0.3s; }
        .login-btn:hover { background: #333; }
        .close-login { position: absolute; top: 15px; right: 20px; font-size: 1.2rem; cursor: pointer; color: #999; }
        .close-login:hover { color: black; }

        .cart-sidebar { position: fixed; top: 0; right: -450px; width: 400px; height: 100%; background: white; z-index: 3000; transition: 0.4s ease; padding: 30px; display: flex; flex-direction: column; box-shadow: -5px 0 30px rgba(0,0,0,0.1); }
        .cart-sidebar.active { right: 0; }
        .cart-item { display: flex; gap: 15px; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 20px; }
        .cart-item img { width: 70px; height: 70px; object-fit: cover; border-radius: 4px; }
        
        select { width: 100%; padding: 15px; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 4px; }
        .btn-black { background: black; color: white; width: 100%; padding: 18px; border: none; border-radius: 50px; font-weight: 600; cursor: pointer; transition: background 0.2s; margin-top: auto; }
        .btn-black:hover { background: #333; }
        .btn-black:disabled { background: #ccc; cursor: not-allowed; }

        /* Loader */
        #loader { text-align: center; padding: 40px; font-weight: bold; color: #555; display: none; }

        @media (max-width: 1024px) { .product-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 768px) {
            .navbar { padding: 15px 20px; flex-direction: column; gap: 15px; }
            .nav-links { position: static; transform: none; margin: 0; gap: 15px; font-size: 0.8rem; width: 100%; justify-content: center; display: flex; flex-wrap: wrap; } 
            .right-group { width: 100%; justify-content: space-between; }
            .search-wrapper { width: 100%; }
            .search-input:focus { width: 100%; }
            .product-grid { grid-template-columns: 1fr; }
            .modal-content { flex-direction: column; }
            .modal-left { height: 250px; }
            .cart-sidebar { width: 100%; }
            .admin-form { grid-template-columns: 1fr; }
            .footer-content { grid-template-columns: 1fr; text-align: center; }
        }
    </style>
</head>
<body>

    <!-- Navbar -->
    <header>
        <div class="navbar">
            <a href="#" class="logo" onclick="switchPage('home')">
                <img src="static/images/logo-text.png" alt="Rahata Store" onerror="this.style.display='none'; this.parentElement.innerHTML='RAHATA STORE'">
            </a>
            
            <ul class="nav-links">
                <li id="nav-home" class="active" onclick="switchPage('home')">Home</li>
                <li id="nav-products" onclick="switchPage('products')">Products</li>
                <li id="nav-sale" onclick="switchPage('sale')">Sale</li>
                <li id="nav-faq" onclick="switchPage('faq')">FAQ</li>
                <li id="nav-about" onclick="switchPage('about')">About Us</li>
            </ul>
            <div class="right-group">
                <div class="search-wrapper">
                    <input type="text" id="search-input" class="search-input" placeholder="Search..." onkeyup="handleSearch()">
                    <i class="fas fa-search search-icon"></i>
                </div>

                <button class="icon-btn" onclick="toggleCart()">
                    <i class="fas fa-shopping-bag"></i>
                    <span class="cart-badge" id="cart-count">0</span>
                </button>
                
                <!-- ADMIN BUTTON -->
                <button class="icon-btn" id="admin-btn" onclick="openLoginModal()" title="Admin Login">
                    <i class="fas fa-user-cog"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- PAGE: HOME -->
    <div id="page-home" class="page-section active">
        <section class="hero">
            <div class="hero-overlay"></div>
            <div class="hero-content">
                <h1>Just Wear It.<br>Style Your Way.</h1>
                <p>Exclusive hoodie collection with premium quality for your active lifestyle.</p>
            </div>
        </section>
        <div class="container">
            <div class="section-title">Best Sellers</div>
            <div class="section-desc">This week's favorites</div>
            <div id="loader-home" style="text-align:center; padding:20px;">Loading Data...</div>
            <div class="product-grid" id="home-grid"></div>
            <div style="text-align:center; margin-bottom:60px;">
                <button class="btn-black" style="width:auto; padding: 12px 40px;" onclick="switchPage('products')">View All Products</button>
            </div>
        </div>
    </div>

    <!-- PAGE: PRODUCTS -->
    <div id="page-products" class="page-section">
        <div class="container" style="padding-top: 40px;">
            <div id="admin-panel" class="admin-panel">
                <h3 style="margin-bottom: 15px; color: var(--admin-color);">Admin Mode: Add Product</h3>
                <div class="admin-form">
                    <input type="text" id="new-name" placeholder="Product Name">
                    <input type="text" id="new-cat" placeholder="Category">
                    <input type="number" id="new-price" placeholder="Normal Price (Rp)">
                    <input type="number" id="new-sale-price" placeholder="Sale Price (Optional)" style="border-color: var(--danger);">
                    <input type="number" id="new-stock" placeholder="Initial Stock">
                    <input type="text" id="new-desc" placeholder="Short Description" class="admin-form-full">
                </div>
                <button class="btn-black" style="background: var(--admin-color); width: auto; padding: 10px 20px;" onclick="addNewProduct()">+ Add Product</button>
                <button class="btn-black" style="background: #555; width: auto; padding: 10px 20px;" onclick="handleLogout()">Logout Admin</button>
                <button class="btn-black" style="background: var(--success); width: auto; padding: 10px 20px;" onclick="resetDatabase()">Reset / Seed Database</button>
            </div>

            <div class="section-title">All Products</div>
            <div class="section-desc">Find your best style from exclusive choices.</div>
            <div id="loader-products" style="text-align:center; padding:20px;">Loading Real-time Data...</div>
            <div class="product-grid" id="products-grid"></div>
            <div id="no-results" style="text-align:center; display:none; padding:40px; color:#777;">No products found.</div>
        </div>
    </div>

    <!-- PAGE: SALE -->
    <div id="page-sale" class="page-section">
        <div class="container" style="padding-top: 40px;">
            <div class="section-title" style="color: var(--danger);">Flash Sale</div>
            <div class="section-desc">Limited offers on selected items.</div>
            <div id="loader-sale" style="text-align:center; padding:20px;">Loading Deals...</div>
            <div class="product-grid" id="sale-grid"></div>
        </div>
    </div>

    <!-- PAGE: FAQ -->
    <div id="page-faq" class="page-section">
        <div class="faq-wrap">
            <div class="section-title">Frequently Asked Questions</div>
            <div class="section-desc">Answers to common questions.</div>
            <div id="faq-container">
                <div class="faq-item" onclick="toggleFaq(this)"><div class="faq-question">How to order? <i class="fas fa-chevron-down faq-icon"></i></div><div class="faq-answer">Select a product, choose size/color, add to bag, and checkout.</div></div>
                <div class="faq-item" onclick="toggleFaq(this)"><div class="faq-question">Shipping time? <i class="fas fa-chevron-down faq-icon"></i></div><div class="faq-answer">Jabodetabek 1-2 days, Other regions 2-4 days via JNE/J&T.</div></div>
                <div class="faq-item" onclick="toggleFaq(this)"><div class="faq-question">Can I exchange sizes? <i class="fas fa-chevron-down faq-icon"></i></div><div class="faq-answer">Yes, within 3 days of receipt, provided tags are attached and item is unwashed.</div></div>
                <div class="faq-item" onclick="toggleFaq(this)"><div class="faq-question">Is the material thick? <i class="fas fa-chevron-down faq-icon"></i></div><div class="faq-answer">Yes, we use Premium Cotton Fleece (280gsm) which is thick, soft, and durable.</div></div>
            </div>
        </div>
    </div>

    <!-- PAGE: ABOUT US -->
    <div id="page-about" class="page-section">
        <div class="about-wrap">
            <div class="section-title">About Rahata Store</div>
            <p class="about-text">Rahata Store is dedicated to providing high-quality streetwear that combines comfort and style. We believe hoodies are more than just warm clothingâ€”they are a lifestyle statement.</p>
            <div class="features">
                <div class="feature-box"><i class="fas fa-gem"></i><h3>Premium Quality</h3></div>
                <div class="feature-box"><i class="fas fa-shipping-fast"></i><h3>Fast Shipping</h3></div>
                <div class="feature-box"><i class="fas fa-tags"></i><h3>Best Price</h3></div>
            </div>
        </div>
    </div>

    <!-- GLOBAL FOOTER -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>Rahata Store</h3>
                <p>Premium hoodies with the latest styles and high-quality materials for your comfort.</p>
            </div>
            <div class="footer-section">
                <h3>Menu</h3>
                <a href="#" onclick="switchPage('home')">Home</a>
                <a href="#" onclick="switchPage('products')">Products</a>
                <a href="#" onclick="switchPage('sale')">Sale</a>
                <a href="#" onclick="switchPage('faq')">FAQ</a>
                <a href="#" onclick="switchPage('about')">About Us</a>
            </div>
            <div class="footer-section">
                <h3>Contact Us</h3>
                <p><i class="fab fa-whatsapp"></i> <a href="https://wa.me/6287785913689" target="_blank" style="display:inline;">Chat WhatsApp</a></p>
                <p><i class="far fa-envelope"></i> support@rahatastore.com</p>
                <p><i class="fas fa-map-marker-alt"></i> Jakarta, Indonesia</p>
            </div>
            <!-- NEW: SOCIAL MEDIA SECTION -->
            <div class="footer-section">
                <h3>Follow Us</h3>
                <p><i class="fab fa-instagram"></i> <a href="https://www.instagram.com/ra1hannnnnnnnn/" target="_blank" style="display:inline;">@ra1hannnnnnnnn</a></p>
                <p><i class="fab fa-tiktok"></i> <a href="https://www.tiktok.com/@n0nchalant777" target="_blank" style="display:inline;">@n0nchalant777</a></p>
                <p><i class="fab fa-facebook"></i> <a href="https://www.facebook.com/profile.php?id=100033432427397" target="_blank" style="display:inline;">Nrea</a></p>
            </div>
        </div>
        <div class="footer-bottom">
            <span>&copy; 2023 Rahata Store. All Rights Reserved.</span>
        </div>
    </footer>

    <!-- LOGIN MODAL (NEW) -->
    <div id="loginModal" class="modal">
        <div class="login-modal-content">
            <span class="close-login" onclick="closeLoginModal()">&times;</span>
            <div class="login-title">Admin Access</div>
            <div class="login-subtitle">Login to manage your store inventory.</div>
            
            <div class="login-error" id="login-error-msg">Incorrect Username or Password.</div>
            
            <input type="text" id="admin-user-input" class="login-field" placeholder="Username">
            <input type="password" id="admin-pass-input" class="login-field" placeholder="Password">
            <button class="login-btn" onclick="performLogin()">Login</button>
        </div>
    </div>

    <!-- Product Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-left" id="modal-img-container"></div>
            <div class="modal-right">
                <span class="close-modal" onclick="closeModal()">&times;</span>
                <h1 style="font-size:1.8rem; font-weight:800; margin-bottom:5px;" id="modal-title">Product Name</h1>
                <p style="color:#777; margin-bottom:15px;" id="modal-category">Kategori</p>
                <p style="color:#555; line-height:1.6; margin-bottom:20px;" id="modal-desc">Description...</p>
                <div id="modal-price-container" style="margin-bottom: 20px;"></div>
                <div style="font-weight:600; margin-bottom:20px;" id="stock-display">Stok: 0</div>
                <label style="font-weight:600; display:block; margin-bottom:8px;">Size</label>
                <select id="modal-size" onchange="updatePrice()">
                    <option value="S" data-extra="0">S</option>
                    <option value="M" data-extra="0">M</option>
                    <option value="L" data-extra="0">L</option>
                    <option value="XL" data-extra="10000">XL (+Rp 10.000)</option>
                    <option value="XXL" data-extra="20000">XXL (+Rp 20.000)</option>
                </select>
                <label style="font-weight:600; display:block; margin-bottom:8px;">Color</label>
                <select id="modal-color"></select>
                <button id="btn-add-cart" class="btn-black" onclick="addToCart()">Add to Bag</button>
            </div>
        </div>
    </div>

    <!-- Cart Sidebar -->
    <div class="cart-sidebar" id="cartSidebar">
        <div style="display:flex; justify-content:space-between; margin-bottom:20px; padding-bottom:10px; border-bottom:1px solid #eee;">
            <h2 style="font-size:1.5rem; font-weight:700;">Bag</h2>
            <span onclick="toggleCart()" style="cursor:pointer; font-size:1.5rem">&times;</span>
        </div>
        <div id="cart-items" style="flex:1; overflow-y:auto;"></div>
        <div style="border-top: 1px solid #eee; padding-top: 20px;">
            <div style="display:flex; justify-content:space-between; margin-bottom: 20px; font-weight:700;"><span>Total</span><span id="cart-total">Rp 0</span></div>
            <button class="btn-black" onclick="processCheckout()">Checkout</button>
        </div>
    </div>

    <!-- FIREBASE MODULES -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, signInAnonymously, signInWithCustomToken } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { getFirestore, collection, doc, setDoc, updateDoc, deleteDoc, onSnapshot } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

        // --- CONFIG ---
        const fmt = (n) => 'Rp ' + n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        const KEY_CART = 'rahata_cart_v19'; // Cart still local
        const ADMIN_USER = "admin"; 
        const ADMIN_PASS = "mhmdrhn777";
        
        let products = [], cart = JSON.parse(localStorage.getItem(KEY_CART)) || [], currentProduct = null;
        let isAdmin = false;

        // --- CATALOG DATA (For Seed Only) ---
        const initialCatalog = [
            { id: 1, name: "Hoodie Cotton", cat: "Lifestyle", price: 310000, desc: "Pure comfort with 100% premium cotton. Soft, cool, and perfect for daily use.", colors: ['Black', 'Grey', 'Navy'], stock: 10 },
            { id: 2, name: "Hoodie Fleece Premium", cat: "Winter", price: 350000, originalPrice: 450000, desc: "Maximum warmth with thick fleece material. Perfect for cold weather without sacrificing style. (SALE ITEM)", colors: ['Grey', 'Black', 'Cream'], stock: 5 },
            { id: 3, name: "Hoodie Oversized", cat: "Streetwear", price: 290000, desc: "Look trendy with a relaxed oversized cut. A streetwear essential you must have.", colors: ['White', 'Black', 'Brown'], stock: 8 },
            { id: 4, name: "Hoodie Zip", cat: "Sport", price: 325000, desc: "Practical and stylish. Zip-up hoodie with a classic design easily paired with any outfit.", colors: ['Navy', 'Black', 'Red'], stock: 12 },
            { id: 5, name: "Sleeveless Hoodie", cat: "Gym", price: 250000, originalPrice: 300000, desc: "Free your movement during workouts or hanging out. Masculine and sporty sleeveless cut. (SALE ITEM)", colors: ['Red', 'Black', 'Blue'], stock: 6 },
            { id: 6, name: "Front Print Hoodie", cat: "Graphic", price: 315000, desc: "Express yourself with high-quality front graphic print. Durable and long-lasting.", colors: ['Green', 'Black', 'White'], stock: 15 }
        ];

        // --- FIREBASE INIT ---
        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        let productsColRef;

        async function initAuth() {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
                
                // Once authenticated, setup listeners
                productsColRef = collection(db, 'artifacts', appId, 'public', 'data', 'products');
                setupRealtimeListener();
            } catch (error) {
                console.error("Auth failed:", error);
            }
        }

        function setupRealtimeListener() {
            onSnapshot(productsColRef, (snapshot) => {
                if(snapshot.empty) {
                    // If empty, user can trigger seed manually or we just show empty
                    document.getElementById('loader-home').innerText = "Database empty. Admin login to Seed.";
                    products = [];
                } else {
                    products = snapshot.docs.map(doc => ({ id: parseInt(doc.id), ...doc.data() }));
                    // Sort by ID to keep order
                    products.sort((a,b) => a.id - b.id);
                    renderAllGrids();
                    hideLoaders();
                }
            }, (error) => {
                console.error("Data fetch error:", error);
                document.getElementById('loader-home').innerText = "Error loading data.";
            });
        }

        // Expose functions to global window for HTML onclick handlers
        window.resetDatabase = async function() {
            if(!confirm("Warning: This will overwrite the online database with default items. Continue?")) return;
            
            // Delete existing (simplified for this demo, usually we batch delete)
            for (let p of products) {
                await deleteDoc(doc(productsColRef, p.id.toString()));
            }

            // Upload initial
            for (let item of initialCatalog) {
                await setDoc(doc(productsColRef, item.id.toString()), item);
            }
            alert("Database reset to defaults!");
        }

        window.addNewProduct = async function() {
            const name = document.getElementById('new-name').value;
            const cat = document.getElementById('new-cat').value;
            const price = parseInt(document.getElementById('new-price').value);
            const stock = parseInt(document.getElementById('new-stock').value);
            const desc = document.getElementById('new-desc').value;
            const sale = document.getElementById('new-sale-price').value;

            if (!name || !price) return alert("Name and Price are required!");
            
            const newId = products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;
            
            const newItem = { 
                id: newId, 
                name, cat, price, stock, desc, 
                colors:['Black','White'],
                ...(sale ? { originalPrice: price, price: parseInt(sale) } : {}) 
            };

            await setDoc(doc(productsColRef, newId.toString()), newItem);
            alert("Product added to Cloud!");
            // No need to render, onSnapshot will do it
        }

        window.deleteProduct = async function(id) {
            if(confirm("Delete this product for EVERYONE?")) {
                await deleteDoc(doc(productsColRef, id.toString()));
            }
        }

        window.editProduct = async function(id) {
            const p = products.find(x => x.id === id);
            const newPrice = prompt("New Price:", p.price);
            if (newPrice) { 
                await updateDoc(doc(productsColRef, id.toString()), { price: parseInt(newPrice) });
            }
        }

        window.addStock = async function(id) {
            const p = products.find(x => x.id === id);
            const quantity = prompt(`Current Stock: ${p.stock}\nHow much to add? (Use negative to remove)`, "10");
            if (quantity !== null) {
                const qty = parseInt(quantity);
                if (!isNaN(qty)) {
                    const newStock = Math.max(0, p.stock + qty);
                    await updateDoc(doc(productsColRef, id.toString()), { stock: newStock });
                }
            }
        }
        
        window.editSale = async function(id) {
            const p = products.find(x => x.id === id);
            const salePrice = prompt(`Enter SALE price for ${p.name} (Normal: ${fmt(p.originalPrice || p.price)}). Enter 0 to remove sale.`);
            if (salePrice !== null) {
                const newSale = parseInt(salePrice);
                if (newSale > 0) {
                    const updates = { price: newSale };
                    if(!p.originalPrice) updates.originalPrice = p.price;
                    await updateDoc(doc(productsColRef, id.toString()), updates);
                } else {
                    if(p.originalPrice) {
                        await updateDoc(doc(productsColRef, id.toString()), {
                            price: p.originalPrice,
                            originalPrice: null // In firestore use deleteField() usually, but null works for simple logic
                        });
                    }
                }
            }
        }

        // --- LOCAL CART & UI ---
        
        function hideLoaders() {
            document.getElementById('loader-home').style.display = 'none';
            document.getElementById('loader-products').style.display = 'none';
            document.getElementById('loader-sale').style.display = 'none';
        }

        window.renderAllGrids = function() {
            renderGrid(products.slice(0, 3), 'home-grid');
            renderGrid(products, 'products-grid');
            const saleItems = products.filter(p => p.originalPrice);
            renderGrid(saleItems, 'sale-grid');
        }

        // LOGIN MODAL
        window.openLoginModal = function() {
            if (isAdmin) {
                handleLogout();
            } else {
                document.getElementById('loginModal').style.display = 'flex';
                document.getElementById('admin-user-input').value = '';
                document.getElementById('admin-pass-input').value = '';
                document.getElementById('login-error-msg').style.display = 'none';
                document.getElementById('admin-user-input').focus();
            }
        }

        window.closeLoginModal = function() {
            document.getElementById('loginModal').style.display = 'none';
        }

        window.performLogin = function() {
            const user = document.getElementById('admin-user-input').value;
            const pass = document.getElementById('admin-pass-input').value;
            const err = document.getElementById('login-error-msg');

            if (user === ADMIN_USER && pass === ADMIN_PASS) {
                isAdmin = true;
                sessionStorage.setItem('rahata_admin', 'true');
                document.body.classList.add('admin-active');
                const btn = document.getElementById('admin-btn');
                if(btn) { btn.classList.add('active-admin'); btn.title = "Logout Admin"; }
                closeLoginModal();
                switchPage('products');
                renderAllGrids();
            } else {
                err.style.display = 'block';
                err.innerText = "Wrong Username or Password";
            }
        }
        
        window.handleLogout = function() {
            if(!confirm("Logout from Admin mode?")) return;
            isAdmin = false;
            sessionStorage.removeItem('rahata_admin');
            document.body.classList.remove('admin-active');
            const btn = document.getElementById('admin-btn');
            if(btn) { btn.classList.remove('active-admin'); btn.title = "Admin Login"; }
            renderAllGrids();
        }

        // Standard Functions
        window.renderGrid = function(data, elementId) {
            const grid = document.getElementById(elementId);
            if(!grid) return;
            grid.innerHTML = '';
            data.forEach(p => {
                const imgPath = `static/images/hoodie${p.id}.jpg`;
                let badge = p.stock <= 0 ? '<span class="stock-badge out">Sold Out</span>' : (p.stock < 5 ? '<span class="stock-badge" style="color:orange">Only ' + p.stock + ' Left</span>' : '');
                let priceHtml = `<div class="product-price">${fmt(p.price)}</div>`;
                if (p.originalPrice) {
                    badge += '<span class="sale-badge">SALE</span>';
                    priceHtml = `<div class="product-price-wrap"><div class="product-discount-price">${fmt(p.price)}</div><div class="product-old-price">${fmt(p.originalPrice)}</div></div>`;
                }
                
                let adminHtml = isAdmin ? `
                    <div class="admin-controls">
                        <button class="btn-admin-edit" onclick="event.stopPropagation(); editProduct(${p.id})">Edit</button>
                        <button class="btn-admin-stock" onclick="event.stopPropagation(); addStock(${p.id})">+ Stock</button>
                        <button class="btn-admin-sale" onclick="event.stopPropagation(); editSale(${p.id})">Sale</button>
                        <button class="btn-admin-delete" onclick="event.stopPropagation(); deleteProduct(${p.id})">Del</button>
                    </div>` : '';

                grid.innerHTML += `
                    <div class="product-card" onclick="openModal(${p.id})">
                        <div class="product-image">${badge}<img src="${imgPath}" onerror="this.style.display='none'"></div>
                        <div class="product-info">
                            <div class="product-title">${p.name}</div>
                            <div class="product-category">${p.cat}</div>
                            ${priceHtml}
                            ${adminHtml}
                        </div>
                    </div>
                `;
            });
        }

        window.switchPage = function(pid) {
            document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-links li').forEach(el => el.classList.remove('active'));
            document.getElementById('page-' + pid).classList.add('active');
            const nav = document.getElementById('nav-' + pid);
            if(nav) nav.classList.add('active');
            window.scrollTo(0,0);
        }

        window.toggleFaq = function(el) { el.classList.toggle('active'); }
        
        window.handleSearch = function() {
            const q = document.getElementById('search-input').value.toLowerCase();
            if (q.length > 0) switchPage('products');
            const f = products.filter(p => p.name.toLowerCase().includes(q));
            renderGrid(f, 'products-grid');
            document.getElementById('no-results').style.display = f.length === 0 ? 'block' : 'none';
        }

        window.openModal = function(id) {
            const p = products.find(x => x.id === id);
            currentProduct = p;
            document.getElementById('modal-title').innerText = p.name;
            document.getElementById('modal-category').innerText = p.cat;
            document.getElementById('modal-desc').innerText = p.desc || '-';
            const priceC = document.getElementById('modal-price-container');
            priceC.innerHTML = p.originalPrice ? `<div style="display:flex; gap:15px; align-items:center;"><span style="font-size:1.5rem; font-weight:700; color:#d32f2f;">${fmt(p.price)}</span><span style="text-decoration:line-through; color:#999; font-size:1.1rem;">${fmt(p.originalPrice)}</span></div>` : `<div style="font-size:1.5rem; font-weight:700;">${fmt(p.price)}</div>`;
            const imgWrap = document.getElementById('modal-img-container');
            imgWrap.innerHTML = `<img src="static/images/hoodie${p.id}.jpg" onerror="this.style.display='none'">`;
            
            const btn = document.getElementById('btn-add-cart');
            const stock = document.getElementById('stock-display');
            if(p.stock > 0) {
                stock.innerText = `Stock: ${p.stock}`;
                stock.style.color = '#007d48';
                btn.disabled = false;
                btn.innerText = "Add to Bag";
                btn.style.background = "black";
            } else {
                stock.innerText = "Sold Out";
                stock.style.color = "#d32f2f";
                btn.disabled = true;
                btn.innerText = "Sold Out";
                btn.style.background = "#ccc";
            }
            
            const colorSelect = document.getElementById('modal-color');
            colorSelect.innerHTML = '';
            const productColors = p.colors || ['Black', 'White']; 
            productColors.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.innerText = c;
                colorSelect.appendChild(opt);
            });

            document.getElementById('modal-size').value = "S";
            document.getElementById('productModal').style.display = 'flex';
        }

        window.closeModal = function() { document.getElementById('productModal').style.display = 'none'; }
        
        window.updatePrice = function() {
            if(!currentProduct) return;
            const sizeEl = document.getElementById('modal-size');
            const extra = parseInt(sizeEl.options[sizeEl.selectedIndex].getAttribute('data-extra'));
            document.querySelector('#modal-price-container span').innerText = fmt(currentProduct.price + extra);
        }

        window.addToCart = function() {
            if(!currentProduct || currentProduct.stock <= 0) return alert("Stock empty.");
            const sizeEl = document.getElementById('modal-size');
            const colorEl = document.getElementById('modal-color');
            const extra = parseInt(sizeEl.options[sizeEl.selectedIndex].getAttribute('data-extra'));
            cart.push({ 
                cartId: Date.now(), 
                pid: currentProduct.id, 
                name: currentProduct.name, 
                price: currentProduct.price + extra, 
                size: sizeEl.value,
                color: colorEl.value
            });
            saveCart(); updateCartList(); closeModal(); toggleCart();
        }

        function saveCart() { localStorage.setItem(KEY_CART, JSON.stringify(cart)); updateCartBadge(); }
        window.removeFromCart = function(cid) { cart = cart.filter(c => c.cartId !== cid); saveCart(); updateCartList(); }
        function updateCartBadge() { document.getElementById('cart-count').innerText = cart.length; }
        
        function updateCartList() {
            const c = document.getElementById('cart-items');
            const t = document.getElementById('cart-total');
            c.innerHTML = '';
            let total = 0;
            cart.forEach(item => {
                total += item.price;
                c.innerHTML += `<div class="cart-item"><img src="static/images/hoodie${item.pid}.jpg" onerror="this.style.display='none'"><div style="flex:1"><div style="font-weight:600;font-size:0.9rem">${item.name}</div><div style="font-size:0.8rem;color:#666">${item.color} | ${item.size}</div><div style="display:flex;justify-content:space-between;margin-top:5px;"><span style="font-weight:600">${fmt(item.price)}</span><span onclick="removeFromCart(${item.cartId})" style="color:red;cursor:pointer;font-size:0.8rem">Remove</span></div></div></div>`;
            });
            t.innerText = fmt(total);
        }
        
        window.toggleCart = function() { document.getElementById('cartSidebar').classList.toggle('active'); }
        
        window.processCheckout = async function() {
            if(cart.length === 0) return alert("Cart is empty");
            
            // OPTIONAL: Decrement stock in database
            // Note: This is simplified. Real apps check stock availability again before decrementing.
            for (let c of cart) {
                const p = products.find(x => x.id === c.pid);
                if (p && p.stock > 0) {
                     await updateDoc(doc(productsColRef, p.id.toString()), { stock: p.stock - 1 });
                }
            }

            let msg = "Hello Rahata Store, my order:\n\n";
            let total = 0;
            cart.forEach((c, i) => { msg += `${i+1}. ${c.name} (${c.color}, ${c.size}) - ${fmt(c.price)}\n`; total += c.price; });
            msg += `\nTotal: ${fmt(total)}`;
            cart = []; saveCart(); updateCartList(); toggleCart();
            window.open(`https://wa.me/6287785913689?text=${encodeURIComponent(msg)}`, '_blank');
        }

        // Init App
        initAuth();
        if (sessionStorage.getItem('rahata_admin') === 'true') {
            isAdmin = true;
            document.body.classList.add('admin-active');
        }
        updateCartBadge();
        updateCartList();

        // Passkey enter listener
        document.getElementById('admin-pass-input').addEventListener("keypress", function(event) {
            if (event.key === "Enter") { performLogin(); }
        });

        window.onclick = (e) => { 
            if(e.target == document.getElementById('productModal')) closeModal(); 
            if(e.target == document.getElementById('loginModal')) closeLoginModal();
        }

    </script>
</body>
</html>
